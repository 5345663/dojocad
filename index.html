<html xmlns="http://www.w3.org/1999/html">
<!-- Full disclosure: JavaScript is not my forte and neither is CSS. -B -->
<!-- Also full disclosure:  In all likelihood I will never have time to make this actually useful -->
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<!-- basically remove all user-scaling options and make the viewport size match the screen size on touch screens -->
<meta name="viewport" content="minimal-ui, width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<head>
    <title>DojoCAD</title>
</head>
<!-- embedded favicon because why not -->
<link href="data:image/png;base64,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" rel="icon" type="image/png" />
<style type="text/css">
    /* common formatting */

    * {
        font-family: sans-serif;
        color: #A0A0C0;
        touch-action: manipulation;
    }

    /************************************************************
     * key element formatting
     ************************************************************/

    /* remove borders from the body */
    body {
        padding: 0;
        border: 0;
    }

    /* remove borders from the body and document, disable scrollbars */
    html, body {
        margin: 0;
        height: 100%;
        overflow: hidden
        overflow-anchor: none;
        /*
        position: fixed;
        width: 100vw;
        height: 100vh;
        @supports (-webkit-appearance:none) {
            height: calc(var(--vh100, 100vh) - 200px);
        }
        */

      /* Hide scrollbar for IE and Edge */
      -ms-overflow-style: none;
      /* Hide scrollbar for Firefox */
      scrollbar-width: none;
    }

    /* Hide scrollbar for Chrome, Safari and Opera */
    html::-webkit-scrollbar, body::-webkit-scrollbar {
      display: none;
    }

    /* grid div, fill the window with no border and add a repeating background image.
       the position of the image is changed as the background is dragged */
    #grid {
        position: absolute;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        padding: 0;
        border: 0;
        background-image: url("img5x/bg-grid.png");
        background-repeat: repeat;
        background-position: 0px 0px;
        background-size: 160px 160px;
    }

    /* floating header at the top */
    #header {
        background-color: #303050;
        position: absolute;
        left: 0ex;
        top: 0ex;
        margin: 0;
        padding: 1ex 1ex;
        border-radius: 1ex;
        z-index: 5;
    }

    /* floating footer at the bottom */
    #footer {
        background-color: #303050;
        position: absolute;
        bottom: 0ex;
        right: 0ex;
        max-width: 75ex;
        margin: 0;
        padding: 1ex;
        border-radius: 1ex;
        z-index: 8;
    }
    /* All the footer stuff was moved to the Help section to save screen real estate
    #footerToggle {
        cursor: pointer;
    }
    #footerHidden {
        display: none;
    }
    */

    /* floating stats bar at the bottom */
    #statsBar {
        background-color: #303050;
        position: absolute;
        bottom: 0ex;
        left: 0ex;
        margin: 0;
        padding: 1.5ex 1ex;
        border-radius: 1ex;
        z-index: 8;
    }

    /* floating sidebar */
    #sidebar {
        background-color: #303050;
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        left: 0ex;
        margin: 0;
        padding: 0ex 0ex;
        border-radius: 1ex;
        z-index: 8;
    }

    /* floating help container, fills the right side up to a max width */
    #help {
        background-color: #303050;
        position: absolute;
        right: 2ex;
        top: 8ex;
        bottom: 8ex;
        max-width: 75ex;
        margin: 0 0 0 2ex;
        padding: 2ex;
        border-radius: 1ex;
        visibility: hidden;
        z-index: 20;
    }

    /* absolutely position the help show/hide button in the upper right corner */
    #helpToggle {
        position: absolute;
        right: 0ex;
        top: 0ex;
        z-index: 21;
    }

    /* help box fills the help container and contains its own scrollbar */
    .helpBox {
        height: 100%;
        /* need to take 3ex off for the 'top' link */
        height: calc(100% - 3ex);
        border-radius: 1ex;
        background: #000000;
        overflow: auto;
        overflow-anchor: none;
    }
    .helpContainer {
        padding: 1ex;
        overflow-anchor: none;
    }

    /************************************************************
     * help section formatting
     ************************************************************/

    h1, h2, h3, h4 {
        color: A0C0F0;
    }
    strong {
        color: 6080B0;
    }
    .warn, .warn * {
        color: D06040;
    }
    a, a i {
        color: #8080FF
    }
    a:visited, a:visited i {
        color: #D080FF
    }
    ul {
        list-style-type: disc;
    }
    li {
        margin: 0;
    }
    .title {
        color: #6080B0;
        font-size: 300%;
        font-variant: small-caps;
        font-weight: bold;
    }
    .helpTop {
        text-align: right;
        padding: 0 0 1ex 0;
    }

    /************************************************************
     * button/menu formatting
     ************************************************************/

    .button, .button-disabled, .button-error, .button-clear {
        margin: 0.5ex;
        border: none;
        padding: 0.5ex;
        text-align: center;
        text-decoration: none;
        font-size: 100%;
        border-radius: 1ex;
        user-select: none;
    }

    .button, a.link-button {
        cursor: pointer;
        background-color: #7070A0;
        color: #FFFFFF;
    }

    .button-disabled {
        background-color: #303050;
        color: #808080;
    }

    .button-disabled > img {
        filter: saturate(0%) brightness(50%);
    }

    .button-error {
        cursor: pointer;
        background-color: #802020;
        color: #FFFFFF;
    }

    #header .button, #header .button-disabled {
        margin: 1ex;
        padding: 1ex;
    }

    .docButton, .docButton-error, .docImgButton, .docImgButton-error, .docImgButton-clear {
        border: none;
        text-decoration: none;
        font-size: 100%;
        border-radius: 0.5ex;
    }

    .docButton {
        margin: 0;
        padding: 0.1ex 0.5ex;
        background-color: #7070A0;
        color: #FFFFFF;
    }

    .docButton-error {
        margin: 0;
        padding: 0.1ex 0.5ex;
        background-color: #802020;
        color: #FFFFFF;
    }

    .docImgButton {
        margin: 0;
        padding: 0.5ex 0.5ex;
        background-color: #7070A0;
        color: #FFFFFF;
    }

    .docImgButton-error {
        margin: 0;
        padding: 1ex 0.5ex;
        background-color: #802020;
        color: #FFFFFF;
    }

    .docImgButton-clear {
        margin: 0;
        padding: 1ex 0;
    }

    .button > img, .button-disabled > img, .button-error > img, .button-clear > img,
    .docImgButton > img, .docImgButton-error > img, .docImgButton-clear > img,
    .field > img, .field-error > img,
    .menu-button > img, .menu-button-error > img, .menu-button-clear > img {
        display: inline-block;
        vertical-align: middle;
    }

    .docImgButton > img, .docImgButton-error > img , .docImgButton-clear > img {
        transform: scale(0.75, 0.75);
    }

    .label {
        color: #FFFFFF;
        user-select: none;
    }

    .field, .field-error {
        margin: 1ex 1ex 1ex 1ex;
        border: none;
        padding: 1ex;
        text-align: center;
        text-decoration: none;
        font-size: 100%;
        border-radius: 1ex;
    }

    input, textarea {
        background-color: #101020;
        border: none;
        color: #D0D0F0;
        padding: 1ex;
        border-radius: 1ex;
    }
    input:invalid {
        background: #801010;
    }

    .field {
        background-color: #202030;
        color: #FFFFFF;
    }

    .field-error {
        background-color: #B02020;
        color: #FFFFFF;
    }

    .menu-table, .menu-table-error {
        margin: 1ex 1ex 1ex 1ex;
        color: #FFFFFF;
        border: none;
        padding: 0;
        margin: 0;
        border-spacing: 1ex;
        border-collapse: separate;
        text-decoration: none;
        font-size: 100%;
        border-radius: 1ex;
        position: absolute;
        user-select: none;
        z-index: 16;
    }

    .menu-table {
        background-color: #202030;
    }

    .menu-table-error {
        background-color: #402020;
    }

    .menu-button, .menu-button-error {
        margin: 1ex 1ex 1ex 1ex;
        border: none;
        padding: 1ex;
        text-align: center;
        text-decoration: none;
        font-size: 100%;
        border-radius: 1ex;
        cursor: pointer;
    }

    .menu-button-clear {
        margin: 0ex;
        border: none;
        padding: 0ex;
        text-align: center;
        text-decoration: none;
        font-size: 100%;
        border-radius: 1ex;
        cursor: pointer;
    }

    .menu-button {
        background-color: #7070A0;
        color: #FFFFFF;
        user-select: none;
    }

    .menu-button-error {
        background-color: #802020;
        color: #FFFFFF;
    }

    .menu-divider {
        margin: 1ex 1ex 1ex 1ex;
        background-color: #303050;
        padding: 1ex;
        border-radius: 1ex;
    }

    /************************************************************
     * elevator formatting
     ************************************************************/

    .floor-button, .floor-button-selected, .floor-button-error, .floor-button-error-selected, .floor-button-empty, .floor-button-empty-selected {
        margin: 0.5ex;
        border: none;
        padding: 1ex;
        text-align: center;
        text-decoration: none;
        font-size: 100%;
        border-radius: 1ex;
        user-select: none;
    }

    .floor-button {
        cursor: pointer;
        background-color: #202030;
        color: #7070A0;
    }

    .floor-button-selected {
        background-color: #505080;
        color: #FFFFFF;
    }

    .floor-button-error {
        cursor: pointer;
        background-color: #802020;
        color: #7070A0;
    }

    .floor-button-error-selected {
        background-color: #F02020;
        color: #FFFFFF;
    }

    .floor-button-empty {
        cursor: pointer;
        background-color: #303050;
        color: #7070A0;
    }

    .floor-button-empty-selected {
        background-color: #303050;
        color: #FFFFFF;
    }

    #header .button, #header .field, #header .button-error, #header .button-clear,
    #statsBar .button, #statsBar .field, #statsBar .button-error {
        margin: 0ex;
    }

    /************************************************************
     * error/debug formatting
     ************************************************************/

    #errorBar {
        background-color: #B00000;
	    font-weight: bold;
	    text-align: left;
	    color: #FFFFFF;
        position: absolute;
        left: 10ex;
        right: 2ex;
        top: 10ex;
        margin: 0;
        padding: 2ex;
        border-radius: 1ex;
        z-index: 7;
    }

    #debugBar {
        background-color: #0000B0;
	    font-weight: bold;
	    text-align: left;
	    color: #FFFFFF;
        position: absolute;
        left: 10ex;
        right: 2ex;
        bottom: 10ex;
        margin: 0;
        padding: 2ex;
        border-radius: 1ex;
        z-index: 7;
        visibility: hidden;
    }

    #errorBar *, #debugBar * {
	    color: #FFFFFF;
    }

    .debugBounds, .debugOverlapBounds, .debugDoorBounds, .debugOverlapDoorBounds {
        position: absolute;
        border-style: solid;
        border-width: 1px;
        z-index: 10;
        pointer-events: none;
    }
    .debugBounds {
        border-color: #0000FF;
    }
    .debugOverlapBounds {
        border-color: #FF00FF;
    }
    .debugDoorBounds {
        border-color: #00FF00;
    }
    .debugOverlapDoorBounds {
        border-color: #FFFF00;
    }

</style>
<script type="text/javascript" language="javascript" src="js/room-metadata.js" ></script>
<script type="text/javascript" language="javascript" src="js/util.js"></script>
<script type="text/javascript" language="javascript" src="js/model.js"></script>
<script type="text/javascript" language="javascript" src="js/rules.js"></script>
<script type="text/javascript" language="javascript" src="js/main.js"></script>
<script type="text/javascript" language="javascript" src="js/events.js"></script>
<script type="text/javascript" language="javascript" src="js/elevator.js"></script>
<script type="text/javascript" language="javascript" src="js/menus.js"></script>
<script type="text/javascript" language="javascript">

    /************************************************************
     * Dynamic panels
     ************************************************************/

    function toggleHelp() {
        var help = document.getElementById("help");
        var helpToggle = document.getElementById("helpToggle");

        if (help.style.visibility == "visible") {
            help.style.visibility = "hidden";
            helpToggle.innerHTML = '<img src="icons/icon-help.png" srcset="icons2x/icon-help.png 2x" title="Show Help"/>';

        } else {
            help.style.visibility = "visible";
            helpToggle.innerHTML = '<img src="icons/icon-close.png" srcset="icons2x/icon-close.png 2x" title="Close Help"/>';
        }
    }

    function toggleFooter() {
        if (window.event && window.event.altKey) {
            // Shhh super secret debug mode don't tell anyone okay
            toggleDebug();
            return;
        }
    }

    function toggleDebug() {
        if (debugEnabled) {
            debugEnabled = false;
            setModelDebug(false);
            showDebug("Debug: off");
            hideDebug();

        } else {
            debugEnabled = true;
            setModelDebug(true);
            showDebug("Debug: on");
        }
    }

    /************************************************************
     * Error and debug bars
     ************************************************************/

    function windowOnError(msg, url, lineNo, columnNo, error) {
        var html = url + ": " + lineNo + ":" + columnNo + "<br/>";
        var html = html + msg.replace("Uncaught ", "");
        showError(html);
        return false;
    }

    function showError(html) {
        clearMenus();
        var errorBarElement = document.getElementById("errorBar");
        errorBarElement.innerHTML = html;
        errorBarElement.style.visibility = "visible";

        return false;
    }

    function clearErrors() {
        // find the error bar and clear it out
        var errorBarElement = document.getElementById("errorBar");
        if (errorBarElement.style.visibility != "hidden") {
            errorBarElement.innerHTML = "";
            errorBarElement.style.visibility = "hidden";
        }
    }

    var debugCount = 0;
    var maxDebugLines = 5;

    function showDebug(html) {
        var debugBarElement = document.getElementById("debugBar");

        while (debugBarElement.childElementCount >= maxDebugLines) {
            debugBarElement.firstElementChild.remove();
        }
        var div = document.createElement("div");
        debugCount++;
        div.innerHTML = debugCount + ". " + html;
        debugBarElement.appendChild(div);

        debugBarElement.style.visibility = "visible";
    }

    function hideDebug() {
        var debugBarElement = document.getElementById("debugBar");

        debugBarElement.style.visibility = "hidden";
    }

    /************************************************************
     * init
     ************************************************************/

    function init() {
        /*
        var vh = window.innerHeight - 34;
        var declaration = document.styleSheets[0].cssRules[0].style;
        declaration.setProperty("--vh100", vh + "px");
        */

        // set up the error listener
        window.onerror = windowOnError;

        // we have to do this with addEventListener() instead of directly on the <div> so we can tell stupid Chrome that
        // none of these event handlers are passive
        var grid = document.getElementById("grid");
        grid.addEventListener("mousedown", mouseDown, { passive: false });
        grid.addEventListener("wheel", wheel, { passive: false });
        grid.addEventListener("touchstart", touchStart, { passive: false });
        grid.addEventListener("touchcancel", touchCancel, { passive: false });

        // javascript is working
        clearErrors();

        // init the model
        initModel();

        /*
        window.onresize();
        */
    }

    /*
    window.onresize = function() {
        var h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        document.body.style.height = h + "px";
        showDebug(h + "");
    }
    */

    function onScroll() {
        // huge freaking hack for Chrome:
        // when you click on a link inside the Help section Chrome scrolls the page, on both mobile and desktop versions.
        // I tried very hard to find a "correct" way to fix this, but nothing worked.
        // This also appears to fix a few auto-scroll issues when switching floors to a floor with rooms off the bottom
        // of the screen in ther browser.

        // So here we are, listening for scroll events and negating them manually.  We're fine, we're all fine here.  How are you?
        document.body.scrollTo(0, 0);
    }

</script>
<body onload="init()" onkeydown="keyDown()" onscroll="onScroll()">

<!-- Grid background -->
<div id="grid"></div>

<!-- Container for room elements -->
<div id="roomContainer"></div>

<!-- floating header bar -->
<div id="header">
    <span id="burgerButton" class="button" onclick="doBurgerMenu(this)"><img src="icons/icon-burger.png" srcset="icons2x/icon-burger.png 2x" title="Menu"/></span>
    <span id="addRoomButton" class="button" onclick="doAddMenu(this)"><img src="icons/icon-add.png" srcset="icons2x/icon-add.png 2x" title="Add Room"/></span>
    <span id="allErrorsButton" class="button-clear" onclick="doShowAllErrors(this)"><img src="icons/icon-ok.png" srcset="icons2x/icon-ok.png 2x" title="OK"/></span>
</div>

<!-- floating sidebar -->
<div id="sidebar">
    <div id="floorUpButton" class="button" onclick="doFloorUp(this)"><img id="floorUpButtonImg" src="icons/icon-up.png" srcset="icons2x/icon-up.png 2x" title="Up"/></div>
    <div id="floorDownButton" class="button" onclick="doFloorDown(this)"><img id="floorDownButtonImg" src="icons/icon-down.png" srcset="icons2x/icon-down.png 2x" title="Down"/></div>
</div>

<!-- floating help button in the corner -->
<div id="helpToggle" class="button" onclick="toggleHelp()"><img src="icons/icon-help.png" srcset="icons2x/icon-help.png 2x" title="Show Help"/></div>

<!-- floating error bar -->
<div id="errorBar">
    Javascript must be enabled
</div>

<!-- floating help window, hidden by default -->
<div id="help">
    <div class="helpTop">
        <a class=".top" href="#TOC">top</a>
    </div>
    <!-- getting padding and sizing correct requires two wrapper divs -->
    <div class="helpBox">
        <div class="helpContainer">
            <p style="text-align: center;">
                <span class="title">DojoCAD</span><br/>
                v1.0.2: 2020-01-17<br/>
                <a href="https://github.com/buff0000n/dojoarch">Source</a>&nbsp;
                <a href="https://github.com/buff0000n/dojoarch/issues/2">Feedback</a>&nbsp;
                <a href="https://github.com/buff0000n/dojocad/issues/new">Bugs</a>
            </p>

            <p>Thanks: <a href="https://www.reddit.com/user/AeliosZero">AeliosZero</a></p>

            <h1>What is this?</h1>
            <p>
                This is a tool for planning a valid Warframe Clan Dojo layout.  I've tried to model the in-game
                room boundaries and constraints as accurately as possible.
            </p>

            <h2>Disclaimer</h2>
            <p class="warn">
                All the room boundaries have been found by in-game experiment, waypoint measurement, or straight-up
                guesswork.
            </p>

            <h1>Getting started</h1>
            <p>
                The starter <strong>Clan Hall</strong> is already added by default.
            </p>
            <p>
                Click the <span class="docButton">Add Room</span> button to select a category and room to add.
                Then drag and click where the room should be placed.
            </p>

            <h2 id="Examples">Examples</h2>
            <ul>
                <li>
                    <a href="?v=2,-317,0,0&m=h1,64,64,0,0_re,64,112,0,2_cc,64,16,0,0_or,64,-15,0,0_cc,32,16,0,0_cc,96,16,0,0_re,96,-16,0,0_lt,96,41,0,2_lb,2,16,0,3_lc,32,-16,0,0_le,32,46,0,2_dd,240,16,0,1_lo,240,-138,0,0_cr,240,160,0,2">
                        Minimal clan dojo
                    </a>
                </li>
                <li>
                    <a href="?m=h1,0,0,0,0_re,-32,-48,0,3_ce,28,-48,-1,1_cc,0,-48,-1,0_re,-32,-48,-1,3_cc,0,48,0,0_h2,0,96,0,0_h3,0,160,0,0_ce,28,48,0,1_cc,0,48,1,0_h4,0,96,1,0_h5,0,0,1,0_or,-31,48,1,3_lt,-41,16,1,3_le,-46,-16,1,3_lc,48,-16,1,1_lb,46,16,1,1_lo,-58,80,1,3_cc,0,-16,-1,0_re,-32,-16,-1,3_re,32,-16,-1,1_cc,0,16,-1,0_dd,0,-192,1,0_cx,0,-48,1,0_cr,48,80,1,1_du,-48,112,1,3_oa,0,274,1,2_gl,64,160,1,0_th,0,160,1,0_gl,-64,160,1,0_oa,-242,160,1,3_re,-32,16,-1,3_re,32,16,-1,1_cc,0,48,-1,0_oc,194,160,1,1_hi,0,224,0,0_hi,64,208,0,1_hi,-64,208,0,1_oa,0,338,0,2_gs,-128,208,0,0_th,-128,160,0,0_gs,128,208,0,0_th,128,160,0,0_gs,-80,160,0,0_cs,-104,208,0,1_gs,80,160,0,0_cs,104,208,0,1_re,-32,48,-1,3_re,32,48,-1,1_cc,0,80,-1,0_gl,-128,256,0,0_gl,128,256,0,0_ob,128,368,0,2_ob,-128,368,0,2_gl,-176,208,0,0_gl,176,208,0,0_re,-32,80,-1,3_re,32,80,-1,1_cc,0,112,-1,0_ce,-128,116,0,0_gl,-128,160,1,0_th,-48,48,0,0_th,80,48,0,0_gs,80,128,0,0_gs,80,96,0,0_gl,128,96,0,0_gs,176,96,0,0_re,32,112,-1,1_re,-32,112,-1,3_cc,0,144,-1,0_gs,176,160,0,0_gs,176,128,0,0_gs,-176,160,0,0_gl,-176,96,0,0_gs,-80,128,0,0_gs,-80,96,0,0_re,32,144,-1,1_re,-32,144,-1,3_cc,0,176,-1,0_ct,48,160,0,0_ct,48,128,0,0_ct,-48,160,0,2_ct,-48,128,0,2_ct,-48,96,0,2_cb,48,96,0,0_cb,48,256,0,3_ct,80,256,0,3_cb,-48,256,0,2_ct,-80,256,0,3_ct,-112,96,0,1_cb,-112,128,0,3_cs,-136,96,0,1_cs,-176,136,0,2_gs,176,256,0,0_gs,-176,256,0,0_cb,128,48,0,1_cb,-48,0,0,1_cb,-80,0,0,3_cs,-80,-24,0,2_cb,-80,-48,0,1_cx,-176,48,0,0_cx,-176,16,0,0_cx,-176,-16,0,0_cx,-176,-48,0,0_cx,-112,-48,0,1_cb,-144,-48,0,3_cb,-144,-80,0,1_cb,-176,-80,0,0_cx,80,0,0,0_re,-32,176,-1,3_cc,0,208,-1,0_cx,176,64,0,0_cx,176,32,0,0_cx,176,0,0,0_cx,176,-32,0,0_cs,176,-56,0,2_cs,80,-24,0,2_cb,80,-48,0,0_cx,112,-48,0,1_cb,144,-48,0,2_cb,176,-80,0,1_cb,144,-80,0,0_cc,0,240,-1,0_b1,-34,208,-1,3_b1,-34,240,-1,3_b1,34,240,-1,1_b1,34,208,-1,1_ct,0,-48,0,1&v=1,-40,-41,1">
                        Maximal clan dojo
                    </a>
                </li>
                <li>
                    <a href="?m=h1,0,0,0,0_re,-32,-48,0,3_ce,28,-48,0,1_ce,28,48,-1,1_h2,0,0,-1,2_h3,0,0,-2,0_h4,0,0,1,0_ce,-28,48,0,3_cc,0,48,1,0_re,-32,-48,-1,3_ce,-28,48,-2,3_ce,-28,-48,1,3_ce,28,48,1,1_cc,0,48,2,0_h5,0,0,2,0_lt,-41,-16,2,3_le,-46,16,2,3_lc,48,-16,2,1_lb,46,16,2,1_or,-47,-16,1,3_lo,-58,16,1,3_ce,-28,48,2,3_ce,28,-48,2,1_ce,28,48,3,1_ce,-28,-48,3,3_ct,0,-48,4,1_ce,28,-48,4,1_ce,-28,48,4,3_hi,0,0,4,0_hi,0,0,3,0_ct,0,-48,5,1_hi,0,0,5,0_ce,-28,-48,5,3_ce,28,48,5,1_th,0,0,6,0_ce,-28,48,6,3_ce,28,-48,6,1_ce,28,-48,-2,1_ce,28,48,-3,1_ce,-28,-48,-3,3_ct,0,48,-2,3_th,0,0,-3,0_gl,0,96,1,0_gl,0,96,2,0_ob,0,144,3,2_ct,0,48,-3,3_ct,0,-48,-3,1_re,-48,0,-3,3_re,48,0,-3,1_re,48,96,1,1_re,-48,96,1,3_ce,28,-48,-4,1_ce,-28,48,-4,3_ct,0,-48,-4,1_ct,0,48,-4,3_gl,0,0,-4,0_re,-48,0,-4,3_re,48,0,-4,1_ce,-28,-48,-5,3_ce,28,48,-5,1_cx,0,48,-5,1_gs,-32,48,-5,0_gs,32,-48,-5,0_ob,0,144,7,2_ct,0,-48,-2,1_cc,0,48,5,0_oa,0,146,5,2_ct,0,48,6,3_ct,0,48,7,1_cc,0,-48,2,0_dd,0,-192,2,0_ct,0,-48,1,1_gl,0,96,0,0_cc,0,48,0,0_gs,48,96,0,0_gs,-48,96,0,0_gs,48,96,2,0_gs,-48,96,2,0_cc,0,48,3,0_ct,0,-48,3,1_cc,0,-48,6,0_ob,0,-144,6,0_cx,0,-48,7,1_gs,-32,-48,7,0_gs,32,48,7,0_oa,0,146,4,2_cc,0,48,4,0_cr,48,-16,1,1_du,-48,-16,3,3_du,-48,16,3,3_du,48,16,3,1_du,48,-16,3,1_gs,0,144,2,0_re,-48,16,4,3_re,-48,-16,4,3_re,48,-16,4,1_re,48,16,4,1_gs,-48,-16,5,0_gs,-48,16,5,0_gs,48,16,5,0_gs,48,-16,5,0_cb,32,16,7,1_cb,-32,-16,7,3_cb,0,16,7,3_cb,0,-16,7,1_cb,-32,16,-5,0_cb,32,-16,-5,2_cb,0,16,-5,2_cb,0,-16,-5,0_cc,0,-48,0,0_gl,0,-96,0,0_re,0,-144,0,0_re,48,-96,0,1_re,-48,-96,0,3_ct,0,-48,-5,3_ob,0,-144,-5,0_cc,0,-48,-1,0_gl,0,-96,-1,0_gs,-48,-96,-1,0_gs,48,-96,-1,0_gs,0,-144,-1,0_gs,0,144,0,0_oa,0,210,1,2_re,-48,0,6,3_re,48,0,6,1_ct,0,48,-1,3&v=2,-29,14,0">
                        Thirteen floor clan dojo
                    </a>
                </li>
                <li>
                    <a href="?m=h1,0,0,0,1_dd,160,0,0,1_cc,-48,0,0,0_cc,-48,-32,0,0_cc,-48,32,0,0_or,-17,32,0,1_cc,-48,-64,0,0_lt,-23,-32,0,1_cc,-48,64,0,0_re,-80,64,0,3_re,-80,-64,0,3_h2,-96,0,0,1_le,-78,-32,0,3_lc,-80,32,0,3_lb,-18,-64,0,1_re,-96,-128,0,3_re,-96,96,0,3_lo,-6,64,0,1_h3,-160,0,0,1_h4,-48,-112,0,0_h5,-48,112,0,0_re,-96,-96,0,3_re,-96,128,0,3_re,0,96,0,1_re,0,128,0,1_re,0,-96,0,1_re,0,-128,0,1_th,160,-160,0,0_th,224,-160,0,0_th,288,-160,0,0_th,352,-160,0,0_th,416,-160,0,0_th,480,-160,0,0_th,544,-160,0,0_th,608,-160,0,0_th,672,-160,0,0_th,736,-160,0,0_th,800,-160,0,0_th,864,-160,0,0_th,928,-160,0,0_th,992,-160,0,0_th,1056,-160,0,0_th,1120,-160,0,0_th,1184,-160,0,0_th,1248,-160,0,0_th,1312,-160,0,0_th,1376,-160,0,0_th,1440,-160,0,0_cx,1440,-112,0,0_cx,1440,-80,0,0_cx,1440,-48,0,0_cx,1440,16,0,0_cx,1440,48,0,0_cx,1440,80,0,0_cx,1440,112,0,0_th,160,160,0,0_th,224,160,0,0_th,288,160,0,0_th,352,160,0,0_th,416,160,0,0_th,480,160,0,0_th,544,160,0,0_th,608,160,0,0_th,672,160,0,0_th,736,160,0,0_th,800,160,0,0_th,864,160,0,0_th,928,160,0,0_th,992,160,0,0_th,1056,160,0,0_th,1120,160,0,0_th,1184,160,0,0_th,1248,160,0,0_th,1312,160,0,0_th,1440,160,0,0_th,1376,160,0,0_cc,-208,0,0,0_re,-240,-32,0,3_re,-240,0,0,3_re,-240,32,0,3_ct,-208,-32,0,2_re,-240,-64,0,3_ce,116,-160,0,3_ce,116,160,-1,3_ce,140,-160,1,1_ce,116,-160,2,3_ce,140,-160,3,1_ce,140,160,-2,1_th,112,112,-2,0_ob,112,-64,4,2_ct,1440,-16,0,0_ce,1468,-16,-1,1_ce,1440,12,-2,2_ce,1440,-12,-3,0_ce,1468,16,-4,1_ob,1344,16,-4,3_cr,-48,-160,0,0_cb,-208,-64,0,1_cb,-208,32,0,2_cb,1440,-16,-1,0_cb,1440,16,-3,3_cx,1440,16,-4,1_cb,112,-160,4,0_cb,112,160,-2,3&v=1,-376,-17,0">
                        Just how big <i>is</i> the Dry Dock?
                    </a>
                </li>
                <li>
                    <a href="?v=1,-82,-17,0&m=h1,32,32,0,1_cc,80,32,0,0_cc,80,0,0,0_cc,80,64,0,0_h2,-32,32,0,1_h3,160,32,0,1_gs,112,32,0,0_re,112,0,0,1_re,112,64,0,1_or,49,64,0,3_lt,55,0,0,3_h4,80,112,0,0_h5,80,-48,0,0_cx,128,-32,0,1_cx,128,96,0,1_gl,80,176,0,0_gl,224,32,0,1_cs,224,-8,0,0_cs,224,72,0,0_cs,264,32,0,1_gs,224,-32,0,0_gs,256,-32,0,0_gs,288,-32,0,0_gs,288,0,0,0_gs,288,32,0,0_gs,288,64,0,0_gs,288,96,0,0_gs,256,96,0,0_gs,224,96,0,0_gs,192,96,0,0_gs,160,96,0,0_hi,176,-48,0,0_re,224,-64,0,0_re,256,-64,0,0_re,288,-64,0,0_re,320,-32,0,1_re,320,0,0,1_re,320,64,0,1_re,320,32,0,1_re,320,96,0,1_le,34,-32,0,3_lc,32,-64,0,3_lb,126,-64,0,1_lo,22,96,0,3_th,-96,32,0,0_gs,-144,32,0,0_gl,-96,96,0,0_gl,-96,-32,0,0_re,-144,0,0,0_re,-144,-32,0,3_re,-144,96,0,3_re,-144,64,0,2_oa,-242,32,0,3_oc,-96,226,0,2_cx,-96,-80,0,0_re,-48,96,0,1_re,-48,-32,0,1_gs,80,224,0,0_gl,80,272,0,0_gs,80,320,0,0_gl,80,368,0,0_cr,32,176,0,3_dd,80,-208,0,0_gl,-96,-128,0,0_ce,192,68,-1,0_ob,-208,-128,0,3_cx,192,96,-1,0_cx,256,96,1,0_ce,256,68,0,0">
                        My actual clan dojo
                    </a>
                </li>
            </ul>

            <h1 id="TOC">Table of Contents</h1>
            <ul>
                <li>
                    <a href="#Navigation">Navigation</a>
                    <ul>
                        <li><a href="#Xooming">Zooming</a></li>
                        <li><a href="#ChangingFloors">Changing Floors</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#Editing">Editing</a>
                    <ul>
                        <li><a href="#SelectingARoom">Selecting a Room</a></li>
                        <li><a href="#AddingARoom">Adding a Room</a></li>
                        <li><a href="#MovingARoom">Moving a Room</a></li>
                        <li><a href="#RotatingARoom">Rotating a Room</a></li>
                        <li><a href="#ChangingARoomsFloor">Changing an Elevator's Floor</a></li>
                        <li><a href="#DeletingARoom">Deleting a Room</a></li>
                        <li><a href="#DeletingEverything">Deleting Everything</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#Constraints">Constraints</a>
                    <ul>
                        <li><a href="#RoomResources">Room Resources</a></li>
                        <li>
                            <a href="#RoomBoundaries">Room Boundaries</a>
                            <ul>
                                <li><a href="#SpecialNoteAboutDryDock">Special Note About the Dry Dock</a></li>
                            </ul>
                        </li>
                        <li><a href="#RoomRules">Specific Room Rules</a></li>
                        <li><a href="#ConstraintFeedback">Other Constraint Feedback</a></li>
                    </ul>
                </li>
                <li><a href="#SavingAndSharing">Saving And Sharing</a></li>
                <li><a href="#ExportToPng">Exporting to PNG</a></li>
                <li><a href="#ToDo">To Do</a></li>
                <li><a href="#KnownIssues">Known Issues</a></li>
            </ul>

            <h1 id="Navigation">Navigation</h1>
            <p>
                Click and drag anywhere in the grid area to move around.
            </p>
            <p>
                This includes clicking on a room, as long as that room isn't currently selected (see
                <a href="#SelectingARoom">Selecting a Room</a>).
            </p>

            <h2 id="Xooming">Zooming</h2>
            <p>
                Use the mouse wheel to zoom in and out.  The cursor marks the center point for zooming.
            </p>
            <p>
                On a touch screen, pinch two fingers to zoom in or spread them to zoom out.
            </p>

            <h2 id="ChangingFloors">Changing Floors</h2>
            <p>
                The highlighted floor on the left side of the screen shows which floor is currently in view.
                The floor numbers start at <strong>1</strong> on the ground floor and go up from there.  Below floor
                <strong>1</strong> is <strong>B1</strong>, and they count down from there.
            </p>
            <p>
                Use the <span class="docImgButton"><img src="icons/icon-up.png" srcset="icons2x/icon-up.png 2x" title="Up"/></span> button above the floor listing to view the next floor up.
                Use the <span class="docImgButton"><img src="icons/icon-down.png" srcset="icons2x/icon-down.png 2x" title="Down"/></span> button to view the next floor down.
            </p>
            <p>
                You can also use the <strong>up</strong> and <strong>down</strong> arrow keys to move between floors.
            </p>
            <p>
                Click on a floor to go directly to it.
            </p>
            <p>
                The floor listing has a maximum number of floors it will display at one time.  If there is overflow
                on the top any/or bottom then the <span class="docImgButton"><img src="icons/icon-up.png" srcset="icons2x/icon-up.png 2x" title="Up"/></span>
                and/or <span class="docImgButton"><img src="icons/icon-down.png" srcset="icons2x/icon-down.png 2x" title="Down"/></span>
                buttons will be replaced with <span class="docImgButton"><img src="icons/icon-up-more.png" srcset="icons2x/icon-up-more.png 2x" title="Up"/></span>
                and/or <span class="docImgButton"><img src="icons/icon-down-more.png" srcset="icons2x/icon-down-more.png 2x" title="Down"/></span>
            </p>
            <p>
                Floors containing rooms with errors will be highlighted in <span class="docButton-error">red</span>.
            </p>

            <h1 id="Editing">Editing</h1>

            <h2 id="SelectingARoom">Selecting a Room</h2>
            <p>
                Select a room by clicking on it without dragging.  The currently selected room will have a blue
                outline around it.
            </p>

            <h2 id="AddingARoom">Adding a Room</h2>
            <p>
                Click the <span class="docImgButton"><img src="icons/icon-add.png" srcset="icons2x/icon-add.png 2x" title="Add Room"/></span>
                button to show a menu of room categories.  Click one of these categories to show a menu of rooms.
                Click one of those rooms to add one under your cursor.  Drag and drop the room to where you want to
                place it.
            </p>
            <p>
                If you have already added a room once, then the <span class="docImgButton"><img src="icons/icon-add.png" srcset="icons2x/icon-add.png 2x" title="Add Room"/></span>
                menu will contain a quick option at the bottom to add another copy of the last room you added.
            </p>
            <p>
                Clicking again on the currently selected room will bring up a menu.  Click
                <span class="docButton">Duplicate</span> to create a copy of that room to place somewhere else.
            </p>
            <p>
                Hitting <strong>Escape</strong> while dragging a newly created room for the first time will cancel the
                add operation and remove the room.
            </p>

            <h2 id="MovingARoom">Moving a Room</h2>
            <p>
                After selecting a room, click again and drag on that room to move it.
            </p>
            <p>
                Hold down <strong>Shift</strong> while dragging a room to snap its position to the nearest 8 meters
                on the grid.  Otherwise the room's position is snapped to the nearest meter.
            </p>
            <p>
                If you drag the room so one of its doors is close to another room's door that's facing the opposite
                direction, then your room will be snapped to that door.
            </p>
            <ul>
                <li>The zone of sensitivity with door snapping does not change with zoom.  If you're having trouble
                    snapping a room to the correct door then try zooming in.</li>
                <li>You can also control the priority of door snapping by clicking a point on the room closer to a
                    particular door when dragging.</li>
            </ul>
            <p>
                Note that <strong>Shift</strong>-dragging and door snapping also apply to newly created rooms that are
                in the process of being placed for the first time.
            </p>
            <p>
                Hitting <strong>Escape</strong> while dragging a room will cancel the operation and return the room
                to where it started.
            </p>

            <h2 id="RotatingARoom">Rotating a Room</h2>
            <p>
                Clicking again on the currently selected room will bring up a menu.  Click
                <span class="docButton">Rotate</span> to rotate the room 90 degrees.
            </p>
            <p>
                Hold down <strong>Shift</strong> and click on the selected room to rotate it 90 degrees without
                having to bring up a menu.
            </p>

            <h2 id="ChangingARoomsFloor">Changing an Elevator's Floor</h2>
            <p>
                Elevators span two floors, either going up from the current floor or going down.  To switch which
                direction an elevator is going, select it and then click again to bring up a menu.  Select
                <span class="docButton">Change Floor</span> to swap the direction the elevator is going.
            </p>

            <h2 id="DeletingARoom">Deleting a Room</h2>
            <p>
                Clicking again on the currently selected room will bring up a menu.  Click
                <span class="docButton">Delete</span> to delete the room.
            </p>
            <p>
                Press the <strong>Delete</strong> key to delete the selected room without having to bring up a menu.
            </p>
            <p>
                Hold down <strong>Alt</strong> and click on a room to delete it with one click.
            </p>

            <h2 id="DeletingEverything">Deleting Everything</h2>
            <p>
                Click on <span class="docImgButton"><img src="icons/icon-burger.png" srcset="icons2x/icon-burger.png 2x" title="Menu"/></span>
                then <span class="docButton">New</span> to start fresh.
            </p>
            <p>
                Note that this opens as a new link, so you can use your browser's <strong>Back</strong> button to go
                back to your previous layout.
            </p>

            <h1 id="Constraints">Constraints</h1>
            <p>
                There are three types on constraints on room placemement: <strong>Room Resources</strong>,
                <strong>Room Boundaries</strong>, and <strong>Room Rules</strong>.
            </p>

            <h2 id="RoomResources">Room Resources</h2>
            <p>
                There are three constraints that affect all rooms in the Dojo:
            </p>
            <ul>
                <li><strong>Room Count:</strong> There's a hard limit of 128 rooms total.</li>
                <li><strong>Energy:</strong> Each room requires some amount of Energy.  You must build
                    <strong>Reactors</strong> to increase the available energy.</li>
                <li><strong>Capacity:</strong> Each room requires some amount of Capacity.  You must build each
                    <strong>Clan Hall</strong> to get more capacity.</li>
            </ul>
            <p>
                The current Room count, Energy, and Capacity of your dojo is displayed in the lower left.  When any
                of those resources is exceeded it will be highlighted in <span class="docButton-error">red</span>.
            </p>

            <h2 id="RoomBoundaries">Room Boundaries</h2>
            <p>
                If you move a room too close to another room so that their boundaries overlap then they will be
                highlighted in <span class="docButton-error">red</span>.  The dojo layout is invalid as long as there
                are any room boundaries overlapping.
            </p>
            <p>
                Note that rooms on adjacent floors may also overlap boundaries.  If a currently visible room is
                overlapping with a room on a different floor then you will see just the other room's boundary in
                <span class="docButton-error">red</span>.
            </p>
            <h3 id="SpecialNoteAboutDryDock">Special Note About the Dry Dock</h3>
            <p>
                The Dry Dock is <strong>very big</strong>.  The outline and bounds visible on the Dry Dock do not
                extend all the way to the back of it, which extends roughly 6-7 times farther than the visible size of
                the Dry Dock.  Boundary collisions with the entire length of the Dry Dock will still be detected, but
                it may not be obvious what's colliding unless you zoom out and find the Dry Dock.
            </p>

            <h2 id="RoomRules">Specific Room Rules</h2>
            <p>
                There are a handful of constraints that apply to specific rooms:
            </p>
            <ul>
                <li>You can only have one of each <strong>Clan Hall</strong></li>
                <li>You need at least one <strong>Clan Hall</strong></li>
                <li>
                    Each <strong>Clan Hall</strong> is the prerequisite for the next bigger <strong>Clan Hall</strong>
                    <ul><li>With the exception of the starter <strong>Hall</strong>, which can be demolished after
                        building the <strong>Clan Great Hall</strong></li></ul>
                </li>
                <li>An <strong>Oracle</strong> is the prequisite for all the Labs</li>
                <li>You can only have up to three <strong>Inspiration Halls</strong></li>
                <li>You can only have up to five <strong>Obstacle Course Architect</strong> rooms</li>
                <li>You can only have up to four <strong>Barracks</strong></li>
                <li>You can only have one <strong>Dry Dock</strong></li>
            </ul>
            <p>
                When a room is violating a specific rule then it will be highlighted in <span class="docButton-error">red</span>.
            </p>

            <h2 id="ConstraintFeedback">Other Constraint Feedback</h2>
            <p>
                When a room is violating a resource, boundary, or rule constraint it will be highlighted in <span class="docButton-error">red</span>.
                Clicking on the room twice to bring up the room menu.  Beside the room name will be a
                <span class="docImgButton-clear"><img src="icons/icon-error.png" srcset="icons2x/icon-error.png 2x" title="Error"/></span>
                button.  Clicking on it will bring up a list of the constraints that the room is breaking.
            </p>
            <p>
                The floor indicator along the left side of the screen will hightlight in <span class="docButton-error">red</span>
                any floors containing rooms with constraint violations.
            </p>
            <p>
                The <span class="docImgButton"><img src="icons/icon-add.png" srcset="icons2x/icon-add.png 2x" title="Add Room"/></span>
                menu will show <span class="docImgButton-clear"><img src="icons/icon-error.png" srcset="icons2x/icon-error.png 2x" title="Error"/></span>
                buttons next to rooms that will have a constraint violation if added.  This also applies to the
                <strong class="docButton">Duplicate</strong> option in the individual room menus.
            </p>
            <p>
                Finally, in the top bar there is a global error icon, either
                <span class="docImgButton-clear"><img src="icons/icon-ok.png" srcset="icons2x/icon-ok.png 2x" title="OK"/></span> or
                <span class="docImgButton-clear"><img src="icons/icon-error.png" srcset="icons2x/icon-error.png 2x" title="Error"/></span>.
                Click on it to bring up a list of all errors detected in the dojo.
            </p>

            <h1 id="SavingAndSharing">Saving And Sharing</h1>
            <p>
                The current layout and view are continually saved to your browser's location bar.
            </p>
            <ul>
                <li>To save your layout, bookmark the current page or copy the current URL from your browser's location
                    bar and save it somewhere.</li>
                <li>To load your layout, open your bookark or paste a previously saved URL into your browser's location
                    bar.</li>
                <li>If you go forward or back in your browser history, then reversing that should restore the layout and
                    view you had previously.</li>
            </ul>
            <p>
                A longcut to copying the URL is also available by clicking
                <span class="docImgButton"><img src="icons/icon-burger.png" srcset="icons2x/icon-burger.png 2x" title="Menu"/></span> then
                <strong class="docButton">Save</strong>, then <strong class="docButton">Copy</strong>.
            </p>
            <h1 id="ExportToPng">Exporting to PNG</h1>
            <p>
                Click <span class="docImgButton"><img src="icons/icon-burger.png" srcset="icons2x/icon-burger.png 2x" title="Menu"/></span>
                then <strong class="docButton">PNG</strong> to bring up a menu for exporting your dojo layout to one or
                more PNG files.
            </p>
            <ul>
                <li>
                    The <strong>Scale</strong> field controls the scale of the PNG image.  It's in
                    <strong>pixels per meter</strong>.  The larger the scale the bigger the image will be.
                </li>
                <li>
                    The <strong>Size</strong> field shows the size of the PNG(s) that will be generated.
                </li>
            </ul>
            <p>
                Click <strong class="docButton">Create</strong> to generate the PNG images.  They will be displayed as
                links for you to download.
            </p>
            <p>
                If your dojo has multiple floors then a separate image is generated for each floor.  The same size and
                positioning is used for each floors' image, so they will line up on top of each other.
            </p>
            <p>
                <strong class="warn">If you have a huge dojo and generate a huge image then it may take a little while
                    for the image links to appear.</strong>
            </p>

            <h1 id="ToDo">To Do</h1>
            <ul>
                <li>
                    Room menu icons
                </li>
                <li>
                    Best guess at the old, discontinued dojo rooms
                </li>
                <li>
                    Add some actions for the error menus, i.e. clicking on the "Oracle is required" error creates an Oracle room to place.
                </li>
                <li>
                    Undo/Redo
                </li>
                <li>
                    Door markers while dragging
                </li>
                <li>
                    Tree structure like a real dojo
                    <ul>
                        <li>Detaching, reattaching, copying, deleting subtrees</li>
                        <li>Build order analysis</li>
                    </ul>
                </li>
                <li>
                    Level of detail image sets for zoom levels
                </li>
                <li>
                    World peace
                </li>
            </ul>

            <h1 id="KnownIssues">Known Issues</h1>
            <ul>
                <li>
                    If you're on a phone, the UI doesn't fit very well in landscape mode.
                </li>
                <li>
                    In Mobile Chrome you can still hide the URL bar and mess up the layout.
                </li>
                <li>
                    There are still some z-index issues, basically visible as a room you're dragging appearing to go
                    underneath other rooms.
                </li>
                <li>
                    Similarly, there are issues with trying to select a room that's within the bounding box of another
                    room
                </li>
                <li>
                    Clicking an internal link in the Help section in Chrome will flicker the screen, because some
                    things in Chrome are very stupid.  Possibly this also happens in mobile Safari, too.
                </li>
                <li>
                    Speaking of Safari, it pops when you switch floors to a floor with rooms off the screen.
                </li>
                <li>
                    PNGs exported with Safari look like ass.
                </li>
            </ul>
        </div>
    </div>
</div>

<div id="debugBar">
</div>

<!-- floating stats bar -->
<span id="statsBar">
    <span class="field"><span id="numRoomsStat" class="stat">0</span><img src="icons/icon-count.png" srcset="icons2x/icon-count.png 2x" title="Room Count"/></span>
    <span class="field"><span id="energyStat" class="stat">0</span><img src="icons/icon-energy.png" srcset="icons2x/icon-energy.png 2x" title="Energy"/></span>
    <span class="field"><span id="capacityStat" class="stat">0</span><img src="icons/icon-capacity.png" srcset="icons2x/icon-capacity.png 2x" title="Capacity"/></span>
</span>

<!-- floating footer bar -->
<div id="footer">
    <span id="footerToggle" onclick="toggleFooter()"><img src="https://i.imgur.com/b5pNXKU.png" srcset="https://i.imgur.com/z6U8Oxs.png 2x"/></span>
</div>

</body>
</html>